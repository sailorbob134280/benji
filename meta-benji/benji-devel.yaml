##########
# HEADER #
##########
header:
  version: 20
  includes:
    - repo: meta-autonomos
      file: includes/base.yaml
    - repo: meta-autonomos
      file: includes/raspberrypi-5.yaml
    - secrets.yaml

##########
# TARGET #
##########
build_system: oe
distro: autonomos
target: autonomos-devel

#########
# Repos #
#########
repos:
  meta-autonomos:
    url: "https://github.com/sailorbob134280/meta-autonomos"
    branch: "main"
    path: "sources/meta-autonomos"
    layers:
      meta-autonomos-core:

#######################
# BUILD CONFIGURATION #
#######################
bblayers_conf_header:
  meta-custom: |
    POKY_BBLAYERS_CONF_VERSION = "2"
    BBPATH = "${TOPDIR}"
    BBFILES ?= ""

local_conf_header:
  standard: |
    PATCHRESOLVE = "noop"
    CONF_VERSION = "2"
    IMAGE_FSTYPES = "tar"
    USER_CLASSES ?= "buildstats"
    TMPDIR = "${TOPDIR}/tmp-${MACHINE}"

  raspberrypi-additional: |
    VIDEO_CAMERA = "1"
    RASPBERRYPI_CAMERA_V3 = "1"

  autonomos: |
    AUTONOMOS_FEATURES = "shellplus containers"

  extras: |
    EXTRA_IMAGE_FEATURES ?= "debug-tweaks"

  diskmonitoring: |
    BB_DISKMON_DIRS ??= "\
    STOPTASKS,${TMPDIR},1G,100K \
    STOPTASKS,${DL_DIR},1G,100K \
    STOPTASKS,${SSTATE_DIR},1G,100K \
    STOPTASKS,/tmp,100M,100K \
    HALT,${TMPDIR},100M,1K \
    HALT,${DL_DIR},100M,1K \
    HALT,${SSTATE_DIR},100M,1K \
    HALT,/tmp,10M,1K"

  parallel: |
    BB_NUMBER_THREADS ?= "${@oe.utils.cpu_count()}"
    PARALLEL_MAKE ?= "-j ${@oe.utils.cpu_count()}"
