

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Architecture &mdash; Benji Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=414a3882" />

  
    <link rel="shortcut icon" href="../_static/logo.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script type="module" src="../_static/js/custom.js?v=13a5d2d9"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RT &lt;-&gt; Compute API" href="rt_compute_api.html" />
    <link rel="prev" title="Benji the Rover" href="../index.html" />
  <meta name="color-scheme" content="dark light">
  
  <noscript id="dark-mode-toggle-stylesheets">
    <link rel="stylesheet" href="../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
    <link rel="stylesheet" href="../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>
  </noscript>
  <script src="../_static/js/dark-mode-toggle-stylesheets-loader.min.js"></script>
  <script type="module" src="../_static/js/dark-mode-toggle.min.mjs"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div class="search-container" role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="search" name="q" placeholder="Search docs"
           aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  <div data-nosnippet>
    
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#software">Software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#real-time-software">Real Time Software</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compute-platform-software">Compute Platform Software</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deep-dives">Deep Dives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="rt_compute_api.html">RT &lt;-&gt; Compute API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#architectural-decision-records">Architectural Decision Records</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../adr/0001-record-architecture-decisions.html">1. Record architecture decisions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adr/0002-split-compute-and-real-time-control-to-separate-processors.html">2. Split compute and real time control to separate processors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adr/0003-use-zephyr-for-the-rt-control-core.html">3. Use Zephyr for the RT control core</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adr/0004-use-embedded-linux-via-yocto-for-the-compute-platform.html">4. Use embedded linux via Yocto for the compute platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adr/0005-version-and-build-all-apps-as-a-single-entity.html">5. Version and build all apps as a single entity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adr/0006-leverage-microservices-for-the-compute-platform.html">6. Leverage microservices for the compute platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adr/0007-use-nats-for-the-compute-message-bus.html">7. Use NATS for the compute message bus</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gnc/index.html">Guidance, Navigation, and Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/index.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/index.html">Projects</a></li>
</ul>

    
    <div class="toctree-wrapper compound">
      <p class="caption"><span class="caption-text">Reference</span></p>
      <ul>
        
        <li class="toctree-l1">
          <a class="reference external" href="https://github.com/sailorbob134280/benji">GitHub Repository</a>
        </li>
        
        <li class="toctree-l1">
          <a class="reference external" href="/presentation/index.html">Overview Presentation</a>
        </li>
        
      </ul>
    </div>
    
  </div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Benji</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!--  -->
  
  
  
  

  <li><a href="../index.html">Docs</a> &raquo;</li>
  
  <li>Architecture</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="architecture">
<h1>Architecture<a class="headerlink" href="#architecture" title="Link to this heading"></a></h1>
<p>Benji overall operates as a split system with a real time processor and a compute platform. The real time processor handles all low-latency real-time tasks such as:</p>
<ul class="simple">
<li><p>Sensor input and processing</p></li>
<li><p>State estimation</p></li>
<li><p>Actuator control</p></li>
<li><p>Short-term waypoint following</p></li>
</ul>
<p>The compute platform handles higher-level tasks such as:</p>
<ul class="simple">
<li><p>Vision processing</p></li>
<li><p>Visual SLAM</p></li>
<li><p>OTA updates</p></li>
<li><p>Path planning</p></li>
<li><p>User interface and monitoring</p></li>
</ul>
<section id="software">
<h2>Software<a class="headerlink" href="#software" title="Link to this heading"></a></h2>
<p><a class="reference download internal" download="" href="../_downloads/c9151d89621e86dd8e2f730da0a282f9/benji_sw_arch.png"><span class="xref download myst"><img alt="Benji Software Architecture" src="../_images/benji_sw_arch.png" /></span></a></p>
<section id="real-time-software">
<h3>Real Time Software<a class="headerlink" href="#real-time-software" title="Link to this heading"></a></h3>
<p>The real-time software is built aroudn the Zephyr RTOS, with all components written in C++. There are a few key components that make up the bulk of the software:</p>
<ul class="simple">
<li><p><strong>Extended Kalman Filter</strong>: Responsible for sensor fusion and state estimation, both of the lower-level sensors (IMU, magnetometer, and wheel encoders) as well as higher-level, lower-rate (and possibly jittery) estimates from visual odometry.</p></li>
<li><p><strong>Controller</strong>: Takes a state estimate and a reference trajectory and producing actuator commands to follow the trajectory as closely as possible.</p></li>
<li><p><strong>Motor CLCs</strong>: Low level closed-loop controllers for the individual wheel motors, responsible for tracking velocity commands from the higher-level controller.</p></li>
<li><p><strong>Command and Telemetry Processor</strong>: Accepts commands from the compute platform (Protobuf) and debug shell to control the robot, and sends telemetry back to the compute platform for monitoring and logging.</p></li>
<li><p><strong>Debug Shell</strong>: A CLI utility for control and calibration via a USB connection.</p></li>
</ul>
<p>Zephyr provides a device-driver model that is quite similar to Linux, as well as a few convenience abstractions such as the Sensor API, which makes hardware selection less critical in the early stages of development. It also has significan driver support for the sensors and peripherals used.</p>
</section>
<section id="compute-platform-software">
<h3>Compute Platform Software<a class="headerlink" href="#compute-platform-software" title="Link to this heading"></a></h3>
<p>The compute platform is an embedded microservice architecture leveraging a blend of C++ and Go services (with Python for prototyping and some vision tasks). Each service communicates primarily via Protobuf messages on a <a class="reference external" href="https://nats.io/">NATS</a> fabric. The main services are:</p>
<ul class="simple">
<li><p><strong>Camera Processor</strong>: Captures frames from the camera at a configurable rate, performs any necessary pre-processing (undistortion, color correction, etc), and publishes the frames to the NATS fabric for consumption by other services.</p></li>
<li><p><strong>Visual SLAM</strong>: Subscribes to camera frames, performs visual SLAM to produce pose estimates and a local map, and publishes that data to the NATS fabric.</p></li>
<li><p><strong>Path Planner</strong>: Subscribes to pose estimates and map data and generates global and local paths for the robot to follow, publishing the paths to the NATS fabric.</p></li>
<li><p><strong>RT Gateway</strong>: Similar to the Command and Telemetry Processor on the real-time side, this service handles communication with the real-time processor, sending commands and receiving telemetry.</p></li>
<li><p><strong>Data Recorder</strong>: Subscribes to various telemetry topics on the NATS fabric and forwards them to InfluxDB for monitoring and analysis.</p></li>
<li><p><strong>Monitoring</strong>: A simple Grafana/InfluxDB stack for basic visualization of telemetry data.</p></li>
<li><p><strong>Update Manager</strong>: Handles OTA updates for both the compute platform and the real-time processor. This is accomplished via primarily via Mender, with some custom tooling for the real-time side.</p></li>
<li><p><strong>API/Web UI</strong>: Provides a REST API and web-based user interface for monitoring and controlling the robot.</p></li>
</ul>
</section>
</section>
<section id="deep-dives">
<h2>Deep Dives<a class="headerlink" href="#deep-dives" title="Link to this heading"></a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="rt_compute_api.html">RT &lt;-&gt; Compute API</a></li>
</ul>
</div>
</section>
<section id="architectural-decision-records">
<h2>Architectural Decision Records<a class="headerlink" href="#architectural-decision-records" title="Link to this heading"></a></h2>
<p>This project leverages Architectural Decision Records (ADRs) to document important decisions made during the design and development of Benji.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../adr/0001-record-architecture-decisions.html">1. Record architecture decisions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adr/0002-split-compute-and-real-time-control-to-separate-processors.html">2. Split compute and real time control to separate processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adr/0003-use-zephyr-for-the-rt-control-core.html">3. Use Zephyr for the RT control core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adr/0004-use-embedded-linux-via-yocto-for-the-compute-platform.html">4. Use embedded linux via Yocto for the compute platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adr/0005-version-and-build-all-apps-as-a-single-entity.html">5. Version and build all apps as a single entity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adr/0006-leverage-microservices-for-the-compute-platform.html">6. Leverage microservices for the compute platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adr/0007-use-nats-for-the-compute-message-bus.html">7. Use NATS for the compute message bus</a></li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
<p>
  &#169; Copyright 2025, Cave in the Mountains.
</p>

  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>