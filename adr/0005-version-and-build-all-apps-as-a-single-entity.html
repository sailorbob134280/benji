

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5. Version and build all apps as a single entity &mdash; Benji Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=414a3882" />

  
    <link rel="shortcut icon" href="../_static/logo.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script type="module" src="../_static/js/custom.js?v=13a5d2d9"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Leverage microservices for the compute platform" href="0006-leverage-microservices-for-the-compute-platform.html" />
    <link rel="prev" title="4. Use embedded linux via Yocto for the compute platform" href="0004-use-embedded-linux-via-yocto-for-the-compute-platform.html" />
  <meta name="color-scheme" content="dark light">
  
  <noscript id="dark-mode-toggle-stylesheets">
    <link rel="stylesheet" href="../_static/css/light.css" type="text/css" media="(prefers-color-scheme: light)"/>
    <link rel="stylesheet" href="../_static/css/dark.css" type="text/css" media="(prefers-color-scheme: dark)"/>
  </noscript>
  <script src="../_static/js/dark-mode-toggle-stylesheets-loader.min.js"></script>
  <script type="module" src="../_static/js/dark-mode-toggle.min.mjs"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div class="search-container" role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="search" name="q" placeholder="Search docs"
           aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  <div data-nosnippet>
    
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../architecture/index.html">Architecture</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../architecture/index.html#software">Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture/index.html#deep-dives">Deep Dives</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../architecture/index.html#architectural-decision-records">Architectural Decision Records</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="0001-record-architecture-decisions.html">1. Record architecture decisions</a></li>
<li class="toctree-l3"><a class="reference internal" href="0002-split-compute-and-real-time-control-to-separate-processors.html">2. Split compute and real time control to separate processors</a></li>
<li class="toctree-l3"><a class="reference internal" href="0003-use-zephyr-for-the-rt-control-core.html">3. Use Zephyr for the RT control core</a></li>
<li class="toctree-l3"><a class="reference internal" href="0004-use-embedded-linux-via-yocto-for-the-compute-platform.html">4. Use embedded linux via Yocto for the compute platform</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">5. Version and build all apps as a single entity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#status">Status</a></li>
<li class="toctree-l4"><a class="reference internal" href="#context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decision">Decision</a></li>
<li class="toctree-l4"><a class="reference internal" href="#consequences">Consequences</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#pros">Pros</a></li>
<li class="toctree-l5"><a class="reference internal" href="#cons">Cons</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="0006-leverage-microservices-for-the-compute-platform.html">6. Leverage microservices for the compute platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="0007-use-nats-for-the-compute-message-bus.html">7. Use NATS for the compute message bus</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gnc/index.html">Guidance, Navigation, and Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/index.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/index.html">Projects</a></li>
</ul>

    
    <div class="toctree-wrapper compound">
      <p class="caption"><span class="caption-text">Reference</span></p>
      <ul>
        
        <li class="toctree-l1">
          <a class="reference external" href="https://github.com/sailorbob134280/benji">GitHub Repository</a>
        </li>
        
        <li class="toctree-l1">
          <a class="reference external" href="presentation/index.html">Overview Presentation</a>
        </li>
        
      </ul>
    </div>
    
  </div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Benji</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!--  -->
  
  
  
  

  <li><a href="../index.html">Docs</a> &raquo;</li>
  
     <li><a href="../architecture/index.html">Architecture</a> &raquo;</li>
  
  <li>5. Version and build all apps as a single entity</li>


  <li class="wy-breadcrumbs-aside">
    <dark-mode-toggle id="dark-mode-toggle" appearance="toggle" permanent="true"/>
  </li>
  <li class="wy-breadcrumbs-aside">
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="version-and-build-all-apps-as-a-single-entity">
<h1>5. Version and build all apps as a single entity<a class="headerlink" href="#version-and-build-all-apps-as-a-single-entity" title="Link to this heading"></a></h1>
<p>Date: 2025-11-23</p>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Link to this heading"></a></h2>
<p>Accepted</p>
</section>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Link to this heading"></a></h2>
<p>Benji is built as a monorepo containing libraries, microcontroller apps (Zephyr), and Linux user-space apps. The compute platform image build uses the Yocto Project (via kas) to compose a base image plus our layer that includes these apps. Additionally, the RT application may leverage some of the same libraries, and will be bundled with the compute image for deployment.</p>
<p>Especially in the early days of the project we want:</p>
<ul class="simple">
<li><p>High velocity development, minimal administrative overhead.</p></li>
<li><p>Developers to change libraries/apps and quickly validate via the image build.</p></li>
<li><p>A clearly traceable release build, but we are not yet expecting extremely fine-grained versioning of each individual component.</p></li>
</ul>
<p>This allows for two ways to version apps in the image:</p>
<ol class="arabic simple">
<li><p><strong>Per-app pinning</strong>: each app recipe pins its <code class="docutils literal notranslate"><span class="pre">SRCREV</span></code> (or fetch source) so the image includes exactly known commits of each app. This allows for independent versioning of each app, but requires updating multiple recipes for each release, and ultimately causes additional release management overhead.</p></li>
<li><p><strong>Monorepo snapshot + externalsrc</strong>: use <code class="docutils literal notranslate"><span class="pre">externalsrc</span></code> in the recipes so the Yocto build picks up from the working tree at a known monorepo commit, treating the monorepo as the version unit. This reduces overhead, but means all apps share the same version (the monorepo commit) with no way to override this.</p></li>
</ol>
<p>Both allow for reproducible builds, it is only the granularity that is impacted. It should be noted that this is not a permanent decision; as the project matures we may want to move to per-app pinning for more flexibility and traceability.</p>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Link to this heading"></a></h2>
<p>We will adopt option (2) — <strong>monorepo snapshot + externalsrc</strong> — for the current project phase.</p>
<ul class="simple">
<li><p>For release builds: we will check out the monorepo at a specific commit or tag and ensure that tag is embedded in the image metadata.</p></li>
<li><p>Our Yocto layer’s app recipes will <code class="docutils literal notranslate"><span class="pre">inherit</span> <span class="pre">externalsrc</span></code> (or equivalent) to pull directly from the monorepo working tree.</p></li>
<li><p>We will disable per-app <code class="docutils literal notranslate"><span class="pre">SRCREV</span></code> pinning during this phase.</p></li>
<li><p>We will document this in our release workflow and ensure developers understand: “All apps in the image come from this monorepo commit.”</p></li>
</ul>
</section>
<section id="consequences">
<h2>Consequences<a class="headerlink" href="#consequences" title="Link to this heading"></a></h2>
<p>Currently, the trade-offs listed below are acceptable given our priorities. As the project evolves and stabilizes, we may revisit this decision.</p>
<section id="pros">
<h3>Pros<a class="headerlink" href="#pros" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Reduced administrative burden: no need to update multiple recipes’ <code class="docutils literal notranslate"><span class="pre">SRCREV</span></code> values each release.</p></li>
<li><p>Faster iteration: changes in libraries/apps can be built and integrated quickly.</p></li>
<li><p>Clear version unit: the monorepo commit is the version for the full image.</p></li>
</ul>
</section>
<section id="cons">
<h3>Cons<a class="headerlink" href="#cons" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>We lose independent versioning of individual apps (e.g., we cannot easily keep app A at version X while moving app B to version Y, unless we branch the monorepo).</p></li>
<li><p>For reproducibility, we rely on a clean working tree and correct checkout; mistakes (uncommitted changes) may lead to unknown image contents.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">externalsrc</span></code> approach may bypass some of Yocto’s canonical fetching behaviour and therefore may demand extra discipline (e.g., ensuring source archives, consistent path, build history).</p></li>
<li><p>If we scale to many apps and variant images, we may hit limitations of this model and incur a migration cost later.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
<p>
  &#169; Copyright 2025, Cave in the Mountains.
</p>

  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>